<head>
	<script language=javascript>
var canvas; var gfx;
var cwidth; var cheight;
var time = 0; var tick = .001;

var planet; var center;

var showVecs = true;
var showTrail = false;

var trail = [];

window.onload = function(){
	canvas = document.createElement('canvas');
	canvas.setAttribute('style','position:absolute; left:0; top:0');
	cwidth = canvas.width = 500;
	cheight = canvas.height = 580;
	document.body.appendChild(canvas);
	gfx = canvas.getContext('2d');

	center = new vec2(300,250);

	planet = {
		pos:new vec2(center.x-250,center.y),
		vel:new vec2(0,+1000),
		acel:new vec2(0,0) // TODO make not zero -- G * mass of sun / radius^2
	}

	setInterval(render,tick);
}

window.onresize = function(){ window.resizeTo(750,650); render(); }

render = function(){

	gfx.fillStyle = 'black';
	gfx.fillRect(0,0,cwidth,cheight);

	gfx.strokeStyle = gfx.fillStyle = 'white'; gfx.lineWidth = 4;
	ellipse2(center.x-33,center.y,center.x-133,center.y,.13,165);

	// star
	gfx.strokeStyle = gfx.fillStyle = 'yellow'; gfx.lineWidth = 1;
	gfx.beginPath(); gfx.arc(center.x,center.y,10,0,Math.PI*2);
	gfx.fill(); gfx.stroke();

	// planet
	gfx.strokeStyle = gfx.fillStyle = 'red';
	gfx.beginPath(); gfx.arc(planet.pos.x,planet.pos.y,10,0,Math.PI*2);
	gfx.fill(); gfx.stroke();

	if(showTrail){
		gfx.strokeStyle = gfx.fillStyle = 'white';
		for(var i in trail){
			gfx.beginPath(); gfx.arc(trail[i].x,trail[i].y,3,0,Math.PI*2);
			gfx.fill(); gfx.stroke();
		}
	}

	if(showVecs){
		// velocity vector
		gfx.strokeStyle = gfx.fillStyle = 'cyan'; gfx.lineWidth = 4;
		gfx.save();
		gfx.translate(planet.pos.x,planet.pos.y);
		gfx.beginPath();
		gfx.moveTo(0,0);
		gfx.lineTo(planet.vel.x/25,planet.vel.y/25);
		gfx.stroke();
		gfx.restore();

		// acceleration vector
		gfx.strokeStyle = gfx.fillStyle = 'magenta'; gfx.lineWidth = 4;
		gfx.save();
		gfx.translate(planet.pos.x,planet.pos.y);
		gfx.beginPath();
		gfx.moveTo(0,0);
		gfx.lineTo(planet.acel.x*5,planet.acel.y*5);
		gfx.stroke();
		gfx.restore();
	}

	gfx.strokeStyle = gfx.fillStyle = 'yellow';  gfx.lineWidth = 1;
	gfx.font = '20px verdana';
	gfx.fillText('Time: ' + ('' + parseFloat(time)*10).substr(0,4), 20, 20);
	gfx.fillText('vel: ' + parseInt(mag(planet.vel)), 20, 45);

	planet.vel = add(planet.vel, planet.acel);
	planet.pos = add(planet.pos, mult(planet.vel, tick));
	planet.acel = mult(unit(sub(center,planet.pos)),500000/Math.pow(mag(sub(center,planet.pos)),2));
			
	if(showTrail){ trail.push(new vec2(planet.pos.x,planet.pos.y)); }

	time += tick;
}

lerp = function(oldMin,oldMax,oldVal,newMin,newMax){
	return (oldVal-oldMin)/(oldMax-oldMin)*(newMax-newMin)+newMin;
}

dist = function(v1,v2){ return mag(add(v1,neg(v2))); }

vec2 = function(x,y){ this.x = x; this.y = y; }
add = function(v1, v2){ return new vec2(v1.x+v2.x, v1.y+v2.y); }
sub = function(v1, v2){ return new vec2(v1.x-v2.x, v1.y-v2.y); }
neg = function(v){ return new vec2(-v.x, -v.y); }
mag = function(v){ return Math.sqrt(Math.pow(v.x,2) + Math.pow(v.y,2)); }
dot = function(v1,v2){ return v1.x*v2.x + v1.y*v2.y; }
unit = function(v){ return new vec2(v.x/mag(v), v.y/mag(v)); }
mult = function(v,s){ return new vec2(v.x*s, v.y*s); }

ellipse2 = function(x1,y1,x2,y2,e,semimajor){
	var center = new vec2((x1+x2)/2,(y1+y2)/2);

	var up = new vec2(0,-1);
	var f = sub(new vec2(x1,y1), new vec2(x2,y2));
	var rot = Math.acos(dot(f,up)/(mag(f)*mag(up)));
	rot -= Math.PI/2;
	if(rot !== 0 && !rot){ rot = Math.PI/2; }

	gfx.save();
	gfx.translate(center.x,center.y);
	gfx.rotate(rot);
	gfx.beginPath();
	for(var i = 0; i < Math.PI*2; i += .01){
		var x = 1.0*semimajor*Math.cos(i);
		var y = (1-e)*semimajor*Math.sin(i)*(-1);
		if(i === 0){ gfx.moveTo(x,y); }else{ gfx.lineTo(x,y); } 
	}
	gfx.stroke();
	gfx.restore();
}

	</script>
</head>
<body bgcolor="grey">
	<form style='position:absolute; left:510px; top:10px;'>
		<select id='planetSelect' style='width:200'>
				<option value = "0">Mercury</option>
				<option value = "1">Venus</option>
				<option value = "2">Earth</option>
				<option value = "3">Mars</option>
				<option value = "4">Jupiter</option>
				<option value = "5">Saturn</option>
				<option value = "6">Uranus</option>
				<option value = "7">Neptune</option>
				<option value = "8">Pluto</option>
				<option value = "9">Halley's Comet</option>
				<option value = "10">Custom</option>
		</select><br></br>
		<b1>Semimajor Axis: </b1><input type='textbox' id='semimajor' style='width:22%'><br></br>
		<b1>Eccentricity: </b1><input type='textbox' id='eccentricity' style='width:14%'><br></br>
		<input type='button' id='playpause' value='Play / Pause'><br></br>
		<input type='checkbox' id='slowmo'><b1>Slow Motion</b1><br></br>
		<input type='checkbox' id='showsectors' checked='true'><b1>Show Sectors</b1>
		&nbsp;&nbsp;&nbsp;&nbsp;
		<b1>Sector Size: </b1><input type='range' id='slider'><br></br>
		<input type='checkbox' id='showvel'><b1>Show Velocity Vector</b1><br></br>
		<input type='checkbox' id='showpos'><b1>Show Position Vector</b1><br></br>
		
		<b1>Distance from the Sun: </b1>
		<input type = 'textbox' id='distbox' style='width:28%' disabled>
		<br></br>
		
		<b1>Velocity</b1><br></br>
		
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<b1>Currently: </b1>
		<input type = 'textbox' id='curvel' style='width:30%' disabled>
		<br></br>
		
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<b1>Minimum: </b1>
		<input type = 'textbox' id='minvel' style='width:30%' disabled>
		<br></br>
		
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<b1>Maximum: </b1>
		<input type = 'textbox' id='maxvel' style='width:30%' disabled>
		<br></br>
	</form>
</body>