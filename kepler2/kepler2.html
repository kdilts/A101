<head>
	<script language=javascript>
var canvas; var gfx;

var cwidth; var cheight;

var planetData = {
	mercury:{ semimajor: .387, ecc: .206, min:38.9, max:59.1 },
	venus:{ semimajor: .723, ecc: .007, min:34.8, max:35.3 },
	earth:{ semimajor: 1.0, ecc: .017, min:29.3, max:30.3 },
	mars:{ semimajor: 1.52, ecc: .093, min:22.0, max:26.5 },
	jupiter:{ semimajor: 5.2, ecc: .048, min:12.5, max:13.7 },
	saturn:{ semimajor: 9.55, ecc: .056, min:9.12, max:10.2 },
	uranus:{ semimajor: 19.2, ecc: .046, min:6.5, max:7.12 },
	neptune:{ semimajor: 30.1, ecc: .009, min:5.39, max:5.48 },
	pluto:{ semimajor: 39.7, ecc: .252, min:3.66, max:6.12 },
	halley:{ semimajor: 17.9, ecc: .967, min:0.913, max:54.4 }
}

window.onload = function(){
	canvas = document.createElement('canvas');
	document.body.appendChild(canvas);
	cwidth = canvas.width = window.innerWidth*.6;
	cheight = canvas.height = window.innerHeight*.99;
	canvas.setAttribute('style','position:absolute; left:0; top:0');

	gfx = canvas.getContext('2d');
	orbiter.init();
	
	setInterval(render,1000/60);
}

window.onresize = function(){
	cwidth = canvas.width = window.innerWidth*.6;
	cheight = canvas.height = window.innerHeight*.99;
	render();
}

window.onmousemove = function(){}

window.onmousedown = function(){}

render = function(){
	gfx.fillStyle='black';
	gfx.fillRect(0,0,cwidth,cheight);

	gfx.fillStyle = gfx.strokeStyle = 'white';
	ellipse2(400,400,600,400,0.17,175);

	gfx.fillStyle = gfx.strokeStyle = 'yellow';
	gfx.beginPath();
	gfx.arc(400,400,20,0,Math.PI*2);
	gfx.fill();
	gfx.stroke();

	orbiter.draw();
}

orbiter = {
	pos:null,
	offset:null,
	rot:Math.PI,
	draw:function(){
		gfx.fillStyle = gfx.strokeStyle = 'red';
		gfx.beginPath();
		gfx.arc(orbiter.pos.x,orbiter.pos.y,10,0,Math.PI*2);
		gfx.fill();
		gfx.stroke();

		orbiter.update();
	},
	update:function(){
		// calculate distance
		var d = mag(sub(orbiter.pos,new vec2(400,400)));
		//console.clear(); console.log(d);
		// calculate velocity
		// update position
		orbiter.pos.x = 1.0*175*Math.cos(orbiter.rot);
		orbiter.pos.y = (1-0.17)*175*Math.sin(orbiter.rot)*(-1);
		orbiter.pos = add(orbiter.pos,orbiter.offset);
		orbiter.rot += lerp(75,275,d,.025,.008);

		if(orbiter.rot > Math.PI*2){ orbiter.rot = orbiter.rot % Math.PI*2 }
	},
	init:function(){
		orbiter.pos = new vec2(325,400);
		orbiter.offset = new vec2(500,400);
	}
}

lerp = function(oldMin,oldMax,oldVal,newMin,newMax){
	return (oldVal-oldMin)/(oldMax-oldMin)*(newMax-newMin)+newMin;
}

dist = function(x1,y1,x2,y2){ return Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2)); }

vec2 = function(x,y){ this.x = x; this.y = y; }
add = function(v1,v2){ return new vec2(v1.x+v2.x, v1.y+v2.y); }
sub = function(v1,v2){ return new vec2(v1.x-v2.x, v1.y-v2.y); }
dot = function(v1,v2){ return v1.x*v2.x + v1.y+v2.y; }
mag = function(v){ return dist(0,0,v.x,v.y); }

ellipse2 = function(x1,y1,x2,y2,e,semimajor){
	var center = new vec2((x1+x2)/2,(y1+y2)/2);

	var up = new vec2(0,-1);
	var f = sub(new vec2(x1,y1), new vec2(x2,y2));
	var rot = Math.acos(dot(f,up)/(mag(f)*mag(up)));
	rot -= Math.PI/2;
	if(!rot){ rot = Math.PI/2; }

	gfx.save();
	gfx.translate(center.x,center.y);
	gfx.rotate(rot);
	gfx.beginPath();
	for(var i = 0; i < Math.PI*2; i += .01){
		var x = 1.0*semimajor*Math.cos(i);
		var y = (1-e)*semimajor*Math.sin(i)*(-1);
		if(i === 0){ gfx.moveTo(x,y); }else{ gfx.lineTo(x,y); } 
	}
	gfx.stroke();
	gfx.restore();
}

ellipse2_center = function(x, y, xrad, yrad){
	gfx.lineWidth=2;
	gfx.strokeStyle='white'; gfx.fillStyle='white';
	gfx.beginPath();

	// formula modified from: http://scienceprimer.com/draw-oval-html5-canvas
		for(var i = 0*Math.PI; i < 2*Math.PI; i += 0.01){
			xpos = x-(yrad*Math.sin(i))*Math.sin(0*Math.PI)+(xrad*Math.cos(i))*Math.cos(0*Math.PI);
			ypos = y+(xrad*Math.cos(i))*Math.sin(0*Math.PI)+(yrad*Math.sin(i))*Math.cos(0*Math.PI);

			if(i === 0){
				gfx.moveTo(xpos,ypos);
			}else{
				gfx.lineTo(xpos,ypos);
			}
		}
	//

	gfx.stroke();

	gfx.beginPath();
	gfx.arc(x,y,2,0,Math.PI*2);
	gfx.fill();
	gfx.stroke();

	var a; var b;
	if(xrad < yrad){ a = yrad; b = xrad; }else{ a = xrad; b = yrad; }
	console.log('>> eccentricity: ' + Math.sqrt(1-Math.pow((b/a),2)));
}

	</script>
</head>
<body bgcolor='grey'>
	<form style='position:absolute; left:62%; top:2%;'>
		<select id='planetSelect' style='width:200'>
				<option value = "0">Mercury</option>
				<option value = "1">Venus</option>
				<option value = "2">Earth</option>
				<option value = "3">Mars</option>
				<option value = "4">Jupiter</option>
				<option value = "5">Saturn</option>
				<option value = "6">Uranus</option>
				<option value = "7">Neptune</option>
				<option value = "8">Pluto</option>
				<option value = "8">Halley's Comet</option>
		</select><br></br>
		<b1>Semimajor Axis: </b1><input type='textbox' id='semimajor'><br></br>
		<b1>Eccentricity: </b1><input type='textbox' id='eccentricity'><br></br>
		<input type='button' id='playpause' value='Play / Pause'><br></br>
		<input type='checkbox' id='slowmo'><b1>Slow Motion</b1><br></br>
		<input type='checkbox' id='showsectors' checked='true'><b1>Show Sectors</b1>
		<input type='slider' id='slider'><br></br>
		<input type='checkbox' id='showvel'><b1>Show Velocity Vector</b1><br></br>
		<br></br>
		<b1>Distance from the Sun: </b1><br></br>
		<br></br>
		<b1>Velocity</b1><br></br>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b1>Currently: </b1><br></br>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b1>Min: </b1><br></br>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b1>Max: </b1><br></br>
	</form>
</body>