<head>
	<script language=javascript>
var canvas; var gfx;

var cwidth; var cheight;

var planetSelector; var semimajorbox; var eccbox; var playpausebutton;
var slowmobox; var showsectorsbox; var slider; var showvelbox;
var minbox; var maxbox; var curbox; var distbox;

var interval; var playing = true;

var orbitEcc = .17; var orbitSemiMajor = 175;

var planetData = {
	mercury:{ semimajor: .387, ecc: .206, min:38.9, max:59.1 },
	venus:{ semimajor: .723, ecc: .007, min:34.8, max:35.3 },
	earth:{ semimajor: 1.0, ecc: .017, min:29.3, max:30.3 },
	mars:{ semimajor: 1.52, ecc: .093, min:22.0, max:26.5 },
	jupiter:{ semimajor: 5.2, ecc: .048, min:12.5, max:13.7 },
	saturn:{ semimajor: 9.55, ecc: .056, min:9.12, max:10.2 },
	uranus:{ semimajor: 19.2, ecc: .046, min:6.5, max:7.12 },
	neptune:{ semimajor: 30.1, ecc: .009, min:5.39, max:5.48 },
	pluto:{ semimajor: 39.7, ecc: .252, min:3.66, max:6.12 },
	halley:{ semimajor: 17.9, ecc: .967, min:0.913, max:54.4 }
}

window.onload = function(){
	canvas = document.createElement('canvas');
	document.body.appendChild(canvas);
	cwidth = canvas.width = window.innerWidth*.6;
	cheight = canvas.height = window.innerHeight*.99;
	canvas.setAttribute('style','position:absolute; left:0; top:0');

	gfx = canvas.getContext('2d');
	orbiter.init();
	
	planetSelector =  document.getElementById('planetSelect');
	semimajorbox = document.getElementById('semimajor');
	eccbox = document.getElementById('eccentricity');
	playpausebutton = document.getElementById('playpause');
	slowmobox = document.getElementById('slowmo');
	showsectorsbox = document.getElementById('showsectors');
	slider = document.getElementById('slider');
	showvelbox = document.getElementById('showvel');

	minbox = document.getElementById('minvel');
	maxbox = document.getElementById('maxvel');
	curbox = document.getElementById('curvel');
	distbox = document.getElementById('distbox');

	semimajorbox.value = ''+planetData.mercury.semimajor;
	eccbox.value = ''+planetData.mercury.ecc;
	semimajorbox.disabled = true; eccbox.disabled = true;
	minbox.value = ''+planetData.mercury.min;
	maxbox.value = ''+planetData.mercury.max;

	playpausebutton.onclick = function(){
		if(playing){
			clearInterval(interval);
			playing = false;
		}else{
			interval = setInterval(render,1000/60);
			playing = true;
		}
	}

	slider.onchange = function(){ } // TODO

	planetSelector.onchange = function(){
		switch(parseInt(planetSelector.value)){
			case 0:
				semimajorbox.value = ''+planetData.mercury.semimajor;
				eccbox.value = ''+planetData.mercury.ecc;
				minbox.value = ''+planetData.mercury.min;
				maxbox.value = ''+planetData.mercury.max;
				semimajorbox.disabled = true; eccbox.disabled = true;
				break;
			case 1:
				semimajorbox.value = ''+planetData.venus.semimajor;
				eccbox.value = ''+planetData.venus.ecc;
				minbox.value = ''+planetData.venus.min;
				maxbox.value = ''+planetData.venus.max;
				semimajorbox.disabled = true; eccbox.disabled = true;
				break;
			case 2:
				semimajorbox.value = ''+planetData.earth.semimajor;
				eccbox.value = ''+planetData.earth.ecc;
				minbox.value = ''+planetData.earth.min;
				maxbox.value = ''+planetData.earth.max;
				semimajorbox.disabled = true; eccbox.disabled = true;
				break;
			case 3:
				semimajorbox.value = ''+planetData.mars.semimajor;
				eccbox.value = ''+planetData.mars.ecc;
				minbox.value = ''+planetData.mars.min;
				maxbox.value = ''+planetData.mars.max;
				semimajorbox.disabled = true; eccbox.disabled = true;
				break;
			case 4:
				semimajorbox.value = ''+planetData.jupiter.semimajor;
				eccbox.value = ''+planetData.jupiter.ecc;
				minbox.value = ''+planetData.jupiter.min;
				maxbox.value = ''+planetData.jupiter.max;
				semimajorbox.disabled = true; eccbox.disabled = true;
				break;
			case 5:
				semimajorbox.value = ''+planetData.saturn.semimajor;
				eccbox.value = ''+planetData.saturn.ecc;
				minbox.value = ''+planetData.saturn.min;
				maxbox.value = ''+planetData.saturn.max;
				semimajorbox.disabled = true; eccbox.disabled = true;
				break;
			case 6:
				semimajorbox.value = ''+planetData.uranus.semimajor;
				eccbox.value = ''+planetData.uranus.ecc;
				minbox.value = ''+planetData.uranus.min;
				maxbox.value = ''+planetData.uranus.max;
				semimajorbox.disabled = true; eccbox.disabled = true;
				break;
			case 7:
				semimajorbox.value = ''+planetData.neptune.semimajor;
				eccbox.value = ''+planetData.neptune.ecc;
				minbox.value = ''+planetData.neptune.min;
				maxbox.value = ''+planetData.neptune.max;
				semimajorbox.disabled = true; eccbox.disabled = true;
				break;
			case 8:
				semimajorbox.value = ''+planetData.pluto.semimajor;
				eccbox.value = ''+planetData.pluto.ecc;
				minbox.value = ''+planetData.pluto.min;
				maxbox.value = ''+planetData.pluto.max;
				semimajorbox.disabled = true; eccbox.disabled = true;
				break;
			case 9:
				semimajorbox.value = ''+planetData.halley.semimajor;
				eccbox.value = ''+planetData.halley.ecc;
				minbox.value = ''+planetData.halley.min;
				maxbox.value = ''+planetData.halley.max;
				semimajorbox.disabled = true; eccbox.disabled = true;
				break;
			case 10:
			semimajorbox.value = '';
			eccbox.value = '';
			minbox.value = ''; // TODO
			maxbox.value = ''; // TODO
			semimajorbox.disabled = false; eccbox.disabled = false;
			break;
		}
	}

	interval = setInterval(render,1000/60);
}

window.onresize = function(){
	cwidth = canvas.width = window.innerWidth*.6;
	cheight = canvas.height = window.innerHeight*.99;
	render();
}

window.onmousemove = function(){}

window.onmousedown = function(){}

render = function(){
	gfx.fillStyle='black';
	gfx.fillRect(0,0,cwidth,cheight);

	gfx.fillStyle = gfx.strokeStyle = 'white';
	ellipse2_center(500,400,orbitSemiMajor,175*Math.sqrt(1-(orbitEcc*orbitEcc*11)));

	gfx.fillStyle = gfx.strokeStyle = 'yellow';
	gfx.beginPath();
	gfx.arc(400,400,20,0,Math.PI*2);
	gfx.fill();
	gfx.stroke();

	orbiter.draw();
}

orbiter = {
	pos:null,
	offset:null,
	rot:Math.PI,
	draw:function(){
		gfx.fillStyle = gfx.strokeStyle = 'red';
		gfx.beginPath();
		gfx.arc(orbiter.pos.x,orbiter.pos.y,10,0,Math.PI*2);
		gfx.fill();
		gfx.stroke();

		orbiter.update();
	},
	update:function(){
		// calculate distance
		var d = mag(sub(orbiter.pos,new vec2(400,400)));
		
		// update position
		orbiter.pos.x = 1.0*orbitSemiMajor*Math.cos(orbiter.rot);
		orbiter.pos.y = (1-orbitEcc)*orbitSemiMajor*Math.sin(orbiter.rot)*(-1);
		orbiter.pos = add(orbiter.pos,orbiter.offset);
		orbiter.rot += lerp(75,275,d,.025,.008);
		if(orbiter.rot > Math.PI*2){ orbiter.rot = orbiter.rot % Math.PI*2 }

		distbox.value = (''+d).substr(0,8);
		curvel.value = (''+lerp(75,275,d,.025,.008)).substr(0,8); // TODO
	},
	init:function(){
		orbiter.pos = new vec2(325,400);
		orbiter.offset = new vec2(500,400);
	}
}

lerp = function(oldMin,oldMax,oldVal,newMin,newMax){
	return (oldVal-oldMin)/(oldMax-oldMin)*(newMax-newMin)+newMin;
}

dist = function(x1,y1,x2,y2){ return Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2)); }

vec2 = function(x,y){ this.x = x; this.y = y; }
add = function(v1,v2){ return new vec2(v1.x+v2.x, v1.y+v2.y); }
sub = function(v1,v2){ return new vec2(v1.x-v2.x, v1.y-v2.y); }
dot = function(v1,v2){ return v1.x*v2.x + v1.y+v2.y; }
mag = function(v){ return dist(0,0,v.x,v.y); }

ellipse2 = function(x1,y1,x2,y2,e,semimajor){
	var center = new vec2((x1+x2)/2,(y1+y2)/2);

	var up = new vec2(0,-1);
	var f = sub(new vec2(x1,y1), new vec2(x2,y2));
	var rot = Math.acos(dot(f,up)/(mag(f)*mag(up)));
	rot -= Math.PI/2;
	if(!rot){ rot = Math.PI/2; }

	gfx.save();
	gfx.translate(center.x,center.y);
	gfx.rotate(rot);
	gfx.beginPath();
	for(var i = 0; i < Math.PI*2; i += .01){
		var x = 1.0*semimajor*Math.cos(i);
		var y = (1-e)*semimajor*Math.sin(i)*(-1);
		if(i === 0){ gfx.moveTo(x,y); }else{ gfx.lineTo(x,y); } 
	}
	gfx.stroke();
	gfx.restore();
}

ellipse2_center = function(x, y, xrad, yrad){
	gfx.lineWidth=2;
	gfx.strokeStyle='white'; gfx.fillStyle='white';
	gfx.beginPath();

	// formula modified from: http://scienceprimer.com/draw-oval-html5-canvas
		for(var i = 0*Math.PI; i < 2*Math.PI; i += 0.01){
			xpos = x-(yrad*Math.sin(i))*Math.sin(0*Math.PI)+(xrad*Math.cos(i))*Math.cos(0*Math.PI);
			ypos = y+(xrad*Math.cos(i))*Math.sin(0*Math.PI)+(yrad*Math.sin(i))*Math.cos(0*Math.PI);

			if(i === 0){
				gfx.moveTo(xpos,ypos);
			}else{
				gfx.lineTo(xpos,ypos);
			}
		}
	//

	gfx.stroke();

	/*gfx.beginPath();
	gfx.arc(x,y,2,0,Math.PI*2);
	gfx.fill();
	gfx.stroke();*/

	var a; var b;
	if(xrad < yrad){ a = yrad; b = xrad; }else{ a = xrad; b = yrad; }
	//console.log('>> eccentricity: ' + Math.sqrt(1-Math.pow((b/a),2)));
}
	</script>
</head>
<body bgcolor='grey'>
	<form style='position:absolute; left:62%; top:2%;'>
		<select id='planetSelect' style='width:200'>
				<option value = "0">Mercury</option>
				<option value = "1">Venus</option>
				<option value = "2">Earth</option>
				<option value = "3">Mars</option>
				<option value = "4">Jupiter</option>
				<option value = "5">Saturn</option>
				<option value = "6">Uranus</option>
				<option value = "7">Neptune</option>
				<option value = "8">Pluto</option>
				<option value = "9">Halley's Comet</option>
				<option value = "10">Custom</option>
		</select><br></br>
		<b1>Semimajor Axis: </b1><input type='textbox' id='semimajor'><br></br>
		<b1>Eccentricity: </b1><input type='textbox' id='eccentricity'><br></br>
		<input type='button' id='playpause' value='Play / Pause'><br></br>
		<input type='checkbox' id='slowmo'><b1>Slow Motion</b1><br></br>
		<input type='checkbox' id='showsectors' checked='true'><b1>Show Sectors</b1>
		&nbsp;&nbsp;&nbsp;&nbsp;
		<input type='range' id='slider'><br></br>
		<input type='checkbox' id='showvel'><b1>Show Velocity Vector</b1><br></br>
		
		<b1>Distance from the Sun: </b1>
		<input type = 'textbox' id='distbox' disabled>
		<br></br>
		
		<b1>Velocity</b1><br></br>
		
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<b1>Currently: </b1>
		<input type = 'textbox' id='curvel' disabled>
		<br></br>
		
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<b1>Min: </b1>
		<input type = 'textbox' id='minvel' disabled>
		<br></br>
		
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<b1>Max: </b1>
		<input type = 'textbox' id='maxvel' disabled>
		<br></br>
	</form>
</body>