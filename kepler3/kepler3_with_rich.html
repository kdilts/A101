<html>
	<head></head>
	<body bgcolor='grey'>
		<script src="js/three.min.js"></script>
		<script src="js/Quaternion.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script>
			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera(
				75, window.innerWidth*.75/window.innerHeight*.95, 0.1, 1000);
			var renderer = new THREE.WebGLRenderer();

			var controls = new THREE.OrbitControls(camera);
			controls.target.z = 0;

			// camera variables
			var dist = 5; var height = 5; var spd = .0175; var camTheta = spd*45;
			
			// planet variables
			var t = 0; var deltaT = 1000/60;
			var theta = []; var deltaTheta = [];
			var r = [];
			var const2 = 0.001; // const1 isn't used. name remains const2 for consistency with formulas given

			var planets = [];

			rToD = Math.PI/180;
	var planetData = [
		{ id: 'Mercury', semimajor: .387, ecc: .206, i: 7*rToD, w: 48*rToD },
		{ id: 'Venus', semimajor: .723, ecc: .007, i: 3.4*rToD, w: 77*rToD },
		{ id: 'Earth', semimajor: 1.0, ecc: .017, i: 0*rToD, w: 0*rToD },
		{ id: 'Mars', semimajor: 1.52, ecc: .093, i: 1.85*rToD, w: 49.6*rToD },
		{ id: 'Jupiter', semimajor: 5.2, ecc: .048, i: 1.3*rToD, w: 100*rToD },
		{ id: 'Saturn', semimajor: 9.55, ecc: .056, i: 2.5*rToD, w: 114*rToD },
		{ id: 'Uranus', semimajor: 19.2, ecc: .046, i: .77*rToD, w: 74*rToD },
		{ id: 'Neptune', semimajor: 30.1, ecc: .009, i: 1.7*rToD, w: 131.7*rToD },
		{ id: 'Pluto', semimajor: 39.7, ecc: .252, i: 17*rToD, w: 110*rToD },
		{ id: 'Halley', semimajor: 17.9, ecc: .967, i: 162*rToD, w: 58.4*rToD },
		{ id: 'Eris', semimajor: 67.7, ecc: .441, i: 44*rToD, w: 35.9*rToD }
	]

			//// build variable arrays that will represent the state of each planet
			for(var p = 0; p < planetData.length; p++){
				r[p] = planetData[p].semimajor*(1-planetData[p].ecc);
				theta[p] = 0;
				deltaTheta[p] = 0;
			}

			//// create orbit rings and add them to the scene
			var lines = [];

			var material = new THREE.LineBasicMaterial({ color: 0xffffff });

			for(var p = 0; p < planetData.length; p++){
				var geometry = new THREE.Geometry();
				var ringTheta = 0; var ringDeltaTheta = 0;
				var a = planetData[p].semimajor;
				var ecc = planetData[p].ecc;

				var ringR = a*(1-ecc);

				while(ringTheta < Math.PI*2.1){
					if(p < 3){
						ringDeltaTheta = (const2*2)/(ringR*ringR)*deltaT;
					}else{
						ringDeltaTheta = (const2*10)/(ringR*ringR)*deltaT;
					}
					ringTheta = ringTheta + ringDeltaTheta;
					ringR = a*(1-Math.pow(ecc,2)) / (1+ecc*Math.cos(ringTheta));

			var ptx =
				ringR*Math.cos(ringTheta - planetData[p].w);

			var ptz =
				ringR*Math.sin(ringTheta - planetData[p].w);

			var pty =
				ringR*Math.sin(planetData[p].i)*Math.sin(ringTheta - planetData[p].w);

		    		geometry.vertices.push(new THREE.Vector3(ptx, pty, ptz));
		    	}
		    	lines.push(geometry);
			}

			for(var p in lines){ scene.add(new THREE.Line(lines[p], material)); }
			////

			renderer.setSize(window.innerWidth*.75, window.innerHeight*.95);
			document.body.appendChild(renderer.domElement);

			//// setup 3js mouse camera controls
			var rotate = function(){
				camera.position.set(Math.cos(camTheta)*dist,height,Math.sin(camTheta)*dist);
				camera.lookAt(new THREE.Vector3(0,0,0));
				camera.position.setLength(dist);
			}

			rotate();
			////

			//var axisHelper = new THREE.AxisHelper(15); scene.add(axisHelper);

			var mx = -1; var my = -1;
			window.onmousemove = function(e){
				mx = e.x; my = e.y;
				if(!mx){ mx = e.clientX; my = e.clientY; }
			}

			var projector = new THREE.Projector();

			window.onmousedown = function(){	

			}

			var render = function () {
				requestAnimationFrame(render);
				
				renderer.render(scene, camera);

				//
				var vector = planets[0].position;
				var v = projector.projectVector( vector, camera );

		        var percX = (v.x + 1) / 2;
		        var percY = (-v.y + 1) / 2;
		        var left = percX * window.innerWidth*.75;
		        var top = percY * window.innerHeight*.95;

		        var pos2d = new THREE.Vector2(left.toFixed(0), top.toFixed(0));

				console.clear();
				console.log(mx, my);
				console.log(pos2d);
				//

				//// update the position of each planet and its label
				for(var p = 0; p < planetData.length; p++){
					deltaTheta[p] = const2/(r[p]*r[p])*deltaT;
					if(planetData[p].id === 'Halley'){ deltaTheta[p] *= -1; }
					theta[p] = theta[p] + deltaTheta[p];
					if(theta[p] >= Math.PI*2){ theta[p] -= Math.PI*2; }
					r[p] = planetData[p].semimajor*(1-Math.pow(planetData[p].ecc,2)) / (1+planetData[p].ecc*Math.cos(theta[p]));
					
					planets[p].position.x = r[p]*Math.cos(theta[p] - planetData[p].w);
					planets[p].position.z = r[p]*Math.sin(theta[p] - planetData[p].w);
					planets[p].position.y = r[p]*Math.sin(planetData[p].i)*Math.sin(theta[p] - planetData[p].w);

				}
				////

				t++; // increment time
			};

			//// create sun sphere and add it to scene
			var geometry = new THREE.SphereGeometry(.25,20,20);
			var material = new THREE.MeshBasicMaterial({color: 0xffff00});
			var star = new THREE.Mesh(geometry, material);
			scene.add(star);
			////

			//// create planet spheres and add them to scene
			var geometry = new THREE.SphereGeometry(.125,20,20);
			var material = new THREE.MeshBasicMaterial({color: 0xff0000});
			for(var p = 0; p < planetData.length; p++){
				planets[p] = new THREE.Mesh(geometry, material);
				scene.add(planets[p]);
				planets[p].position.x = r[p];
			}
			////

			render();
		</script>

	</body>
</html>