<head>
	<style>
		body{color:white; font-size: 18px;}
	</style>
	<script language=javascript>
var canvas; var gfx;
var cwidth; var cheight;
var center;
var s1; var s2;
var initV1 = .2; var initV2 = -.2;
var G = 20;
var play = false; var trace = true;
var tick = 0;

var playButton; var resetButton;
var gBox; var m1Box; var m2Box; var d1Box; var d2Box;

var redTrace = []; var yellowTrace = []; var blueTrace = [];

window.onload = function(){
	canvas = document.createElement('canvas');
	canvas.setAttribute('style','position:absolute; left:0; top:0; z-index:-1');
	cwidth = canvas.width = window.innerWidth;
	cheight = canvas.height = window.innerHeight;
	document.body.appendChild(canvas);
	gfx = canvas.getContext('2d');

	center = new vec2(cwidth/2,cheight/2);

	s1 = new star1(1,cwidth/2-100);
	s2 = new star2(1,cwidth/2+100);

	playButton = document.getElementById('playButton');
	resetButton = document.getElementById('resetButton');
	traceButton = document.getElementById('traceButton');

	gBox = document.getElementById('gBox');
	v1Box = document.getElementById('v1Box'); v2Box = document.getElementById('v2Box'); 
	m1Box = document.getElementById('m1Box'); m2Box = document.getElementById('m2Box');
	d1Box = document.getElementById('d1Box'); d2Box = document.getElementById('d2Box');

	gBox.value = G; m1Box.value = s1.mass; m2Box.value = s2.mass;
	d1Box.value = s1.initX-cwidth/2; d2Box.value = s2.initX-cwidth/2;
	v1Box.value = initV1; v2Box.value = initV2;

	gBox.onchange = function(){ G = gBox.value; }
	m1Box.onchange = function(){ s1.mass = parseFloat(m1Box.value); }
	m2Box.onchange = function(){ s2.mass = parseFloat(m2Box.value); }
	d1Box.onchange = function(){ s1.initX = parseFloat(d1Box.value)+cwidth/2; }
	d2Box.onchange = function(){ s2.initX = parseFloat(d2Box.value)+cwidth/2; }
	v1Box.onchange = function(){ initV1 = parseFloat(v1Box.value); }
	v2Box.onchange = function(){ initV2 = parseFloat(v2Box.value); }

	playButton.onclick = function(){
		if(play){ play = false; playButton.value = 'start'; }
		else{ play = true; playButton.value = 'stop'; }
	}

	resetButton.onclick = function(){
		play = false; playButton.value = "start";

		redTrace = []; blueTrace = []; yellowTrace = [];

		s1.pos = new vec2(s1.initX, cheight/2);
		s1.vel = new vec2(0,initV1);
		s1.accel = new vec2(0,0);
		
		s2.pos = new vec2(s2.initX, cheight/2);
		s2.vel = new vec2(0,initV2);
		s2.accel = new vec2(0,0);

		render();
	}

	traceButton.onclick = function(){
		if(trace){
			trace = false;
			traceButton.value = 'show trace';
			redTrace = []; blueTrace = []; yellowTrace = [];
		}else{
			trace = true;
			traceButton.value = 'hide trace';
		}
	}

	setInterval(render,1000/60);
}

window.onresize = function(){ render(); }

star1 = function(m,posX){
	this.mass = m; this.initX = posX;
	this.vel = new vec2(0,initV1);
	this.pos = new vec2(posX,cheight/2);
	this.accel = new vec2(0,0);

	this.update = function(){
		this.vel = add(this.vel, this.accel);
		this.pos = add(this.pos, this.vel);
		this.accel = sub(s2.pos, this.pos);

	// (G*(m1*m2/r^2))/m2
	
		var m1 = this.mass; var m2 = s2.mass;

		var r = mag(this.accel);

		this.accel = unit(this.accel);
		this.accel = mult(this.accel, (G*(m1*m2/(r*r)))/m2);
	}
}

star2 = function(m,posX){
	this.mass = m; this.initX = posX;
	this.vel = new vec2(0,initV2);
	this.pos = new vec2(posX,cheight/2);
	this.accel = new vec2(0,0);

	this.update = function(){
		this.vel = add(this.vel, this.accel);
		this.pos = add(this.pos, this.vel);
		this.accel = sub(s1.pos, this.pos);

	// (G*(m1*m2/r^2))/m2
	
		var m1 = this.mass; var m2 = s1.mass;

		var r = mag(this.accel);

		this.accel = unit(this.accel);
		this.accel = mult(this.accel, (G*(m1*m2/(r*r)))/m2);
	}
}

render = function(){
	cwidth = canvas.width = window.innerWidth;
	cheight = canvas.height = window.innerHeight;
	gfx.font = "22px verdana";

	gfx.clearRect(0,0,cwidth,cheight);

	gfx.strokeStyle = gfx.fillStyle = 'white';
	gfx.beginPath();
	gfx.moveTo(s1.pos.x,s1.pos.y);
	gfx.lineTo(s2.pos.x,s2.pos.y);
	gfx.stroke();

	gfx.strokeStyle = gfx.fillStyle = 'yellow';
	gfx.beginPath();
	gfx.arc((s1.pos.x+s2.pos.x)/2,(s1.pos.y+s2.pos.y)/2,2,0,Math.PI*2);
	gfx.fill(); gfx.stroke();

	gfx.strokeStyle = gfx.fillStyle = 'red';
	gfx.fillText('Star 1 vel: ' + s1.vel.x.toFixed(4) + ' , ' + s1.vel.y.toFixed(4), 20,250);
	gfx.beginPath();
	gfx.arc(s1.pos.x,s1.pos.y,s1.mass*4,0,Math.PI*2);
	gfx.fill(); gfx.stroke();

	gfx.strokeStyle = gfx.fillStyle = 'blue';
	gfx.fillText('Star 2 vel: ' + s2.vel.x.toFixed(4) + ' , ' + s2.vel.y.toFixed(4), 20,280);
	gfx.beginPath();
	gfx.arc(s2.pos.x,s2.pos.y,s2.mass*4,0,Math.PI*2);
	gfx.fill(); gfx.stroke();

	if(trace){
		for(var i in redTrace){
			gfx.strokeStyle = gfx.fillStyle = 'red';
			gfx.beginPath();
			gfx.arc(redTrace[i].x,redTrace[i].y,2,0,Math.PI*2);
			gfx.fill(); gfx.stroke();

			gfx.strokeStyle = gfx.fillStyle = 'blue';
			gfx.beginPath();
			gfx.arc(blueTrace[i].x,blueTrace[i].y,2,0,Math.PI*2);
			gfx.fill(); gfx.stroke();

			gfx.strokeStyle = gfx.fillStyle = 'yellow';
			gfx.beginPath();
			gfx.arc(yellowTrace[i].x,yellowTrace[i].y,2,0,Math.PI*2);
			gfx.fill(); gfx.stroke();
		}

		if(tick === 0){
			redTrace.push(s1.pos);
			blueTrace.push(s2.pos);
			yellowTrace.push(mult(add(s1.pos,s2.pos),0.5));
		}
	}

	if(play){
		s1.update(); s2.update();
		gBox.value = G; m1Box.value = s1.mass; m2Box.value = s2.mass;
		d1Box.value = s1.initX-cwidth/2; d2Box.value = s2.initX-cwidth/2;
		v1Box.value = initV1; v2Box.value = initV2;
		tick++;
		if(tick == 25){ tick = 0; }
	}
}

lerp = function(oldMin,oldMax,oldVal,newMin,newMax){
	return (oldVal-oldMin)/(oldMax-oldMin)*(newMax-newMin)+newMin;
}

dist = function(v1,v2){ return mag(add(v1,neg(v2))); }

vec2 = function(x,y){ this.x = x; this.y = y; }
add = function(v1, v2){ return new vec2(v1.x+v2.x, v1.y+v2.y); }
sub = function(v1, v2){ return new vec2(v1.x-v2.x, v1.y-v2.y); }
neg = function(v){ return new vec2(-v.x, -v.y); }
mag = function(v){ return Math.sqrt(Math.pow(v.x,2) + Math.pow(v.y,2)); }
dot = function(v1,v2){ return v1.x*v2.x + v1.y*v2.y; }
unit = function(v){ return new vec2(v.x/mag(v), v.y/mag(v)); }
mult = function(v,s){ return new vec2(v.x*s, v.y*s); }

	</script>
</head>
<body bgcolor="black">
	<form>
		<input type="button" value="start" id="playButton">&nbsp;&nbsp;&nbsp;
		<input type="button" value="reset" id="resetButton">&nbsp;&nbsp;&nbsp;
		<input type="button" value="hide trace" id="traceButton">
		<br><br>
		<b1>G: </b1><input type="text" size="2" id="gBox"><br><br>
		<b1>initV 1: </b1><input type="text" size="2" id="v1Box">&nbsp;&nbsp;&nbsp;
		<b1>initV 2: </b1><input type="text" size="2" id="v2Box"><br><br>
		<b1>Mass 1: </b1><input type="text" size="2" id="m1Box">&nbsp;&nbsp;&nbsp;
		<b1>Mass 2: </b1><input type="text" size="2" id="m2Box"><br><br>
		<b1>Dist 1: </b1><input type="text" size="2" id="d1Box">&nbsp;&nbsp;&nbsp;
		<b1>Dist 2: </b1><input type="text" size="2" id="d2Box"><br><br>
	</form>
</body>