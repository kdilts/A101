<head>
	<style>
		body{color:white; font-size: 18px;}
	</style>
	<script language=javascript>
var canvas; var gfx;
var cwidth; var cheight;
var center;
var s1; var s2;
var initV1; var initV2; var period; var ecc;
var G = 6.67384 * Math.pow(10,-11);
var play = false; var trace = true; var showVecs = true;
var tick = 0;

var playButton; var resetButton; var vecButton;
var gBox; var m1Box; var m2Box; var sepBox; var eccBox; var pBox;

var redTrace = []; var yellowTrace = []; var blueTrace = [];

var yellowPos;

var solarRad = 10; var kmPerRad = 695500;
var sunMass = 1.989 * Math.pow(10,30); 

window.onload = function(){
	canvas = document.createElement('canvas');
	canvas.setAttribute('style','position:absolute; left:0; top:0; z-index:-1');
	cwidth = canvas.width = window.innerWidth;
	cheight = canvas.height = window.innerHeight;
	document.body.appendChild(canvas);
	gfx = canvas.getContext('2d');

	center = new vec2(cwidth/2,cheight/2);

	playButton = document.getElementById('playButton');
	resetButton = document.getElementById('resetButton');
	traceButton = document.getElementById('traceButton');
	vecButton = document.getElementById('vecButton');

	gBox = document.getElementById('gBox');
	v1Box = document.getElementById('v1Box'); v2Box = document.getElementById('v2Box'); 
	m1Box = document.getElementById('m1Box'); m2Box = document.getElementById('m2Box');
	sepBox = document.getElementById('sepBox');
	pBox = document.getElementById('pBox');
	eccBox = document.getElementById('eccBox');

	gBox.value = G; sepBox.value = 6; ecc = eccBox.value = .7;

	s1 = new star1(1,cwidth/2 - (sepBox.value*solarRad) );
	s2 = new star2(1,cwidth/2 + (sepBox.value*solarRad) );

	m1Box.value = s1.mass; m2Box.value = s2.mass;

	gBox.onchange = function(){ G = gBox.value; }
	m1Box.onchange = function(){ s1.mass = parseFloat(m1Box.value); }
	m2Box.onchange = function(){ s2.mass = parseFloat(m2Box.value); }
	sepBox.onchange = function(){ s1.initX = parseFloat(sepBox.value)+cwidth/2; }
	v1Box.onchange = function(){ initV1 = parseFloat(v1Box.value); }
	v2Box.onchange = function(){ initV2 = parseFloat(v2Box.value); }
	eccBox.onchange = function(){ ecc = parseFloat(eccBox.value); }

	calculatePeriod = function(a, m1, m2){ return Math.sqrt( (a*a*a)/(m1+m2) );	}

	calculateInitV = function(p,a,e){ return (2*Math.PI*a*(1+e)) / (p*Math.sqrt(1-e*e)); }

	pBox.value = period = calculatePeriod(sepBox.value*kmPerRad, s1.mass*sunMass, s2.mass*sunMass); // use km or meters?

	v1Box.value = initV1 = calculateInitV(period*1000, sepBox.value*kmPerRad, ecc);
	v2Box.value = initV2 = -initV1;

	initV1 = initV1/100000000000000;
	initV2 = initV2/100000000000000;
	G = G * 100000000000;

	playButton.onclick = function(){
		if(play){ play = false; playButton.value = 'start'; }
		else{ play = true; playButton.value = 'stop'; }
	}

	resetButton.onclick = function(){
		play = false; playButton.value = "start";

	pBox.value = period = calculatePeriod(sepBox.value*kmPerRad, s1.mass*sunMass, s2.mass*sunMass);

	v1Box.value = initV1 = calculateInitV(period, sepBox.value*kmPerRad, ecc);
	v2Box.value = initV2 = -initV1;

	initV1 = initV1/100000000000000;
	initV2 = initV2/100000000000000;
	G = G * 100000000000;

		redTrace = []; blueTrace = []; yellowTrace = [];

		s1.pos = new vec2(cwidth/2-(sepBox.value*solarRad), cheight/2);
		s1.vel = new vec2(0,initV1);
		s1.accel = new vec2(0,0);
		
		s2.pos = new vec2(cwidth/2+(sepBox.value*solarRad), cheight/2);
		s2.vel = new vec2(0,initV2);
		s2.accel = new vec2(0,0);

		render();
	}

	traceButton.onclick = function(){
		if(trace){
			trace = false;
			traceButton.value = 'show trace';
			redTrace = []; blueTrace = []; yellowTrace = [];
		}else{
			trace = true;
			traceButton.value = 'hide trace';
		}
	}

	vecButton.onclick = function(){
		if(showVecs){
			vecButton.value = "hide vectors";
			showVecs = false;
		}else{
			vecButton.value = "show vectors";
			showVecs = true;
		}
	}

	setInterval(render,1000/60);
}

window.onresize = function(){ render(); }

star1 = function(m,posX){
	this.mass = m; this.initX = posX;
	this.vel = new vec2(0,initV1);
	this.pos = new vec2(posX,cheight/2);
	this.accel = new vec2(0,0);

	this.update = function(){
		this.accel = sub(s2.pos, this.pos); // pixels
		//this.accel = mult(this.accel, 1/69550); // change to km

	// (G*(m1*m2/r^2))/m2
	
		var m1 = this.mass; var m2 = s2.mass; // sun mass
		//m1 = m1*sunMass; m2 = m2*sunMass; // change to kg

		var r = mag(this.accel); // should be km because accel is km

		this.accel = unit(this.accel);
		this.accel = mult(this.accel, (G*(m1*m2/(r*r)))/m2);
		
		this.vel = add(this.vel, this.accel);
		this.pos = add(this.pos, this.vel);
	}
}

star2 = function(m,posX){
	this.mass = m; this.initX = posX;
	this.vel = new vec2(0,initV2);
	this.pos = new vec2(posX,cheight/2);
	this.accel = new vec2(0,0);

	this.update = function(){
		this.accel = sub(s1.pos, this.pos);
		//this.accel = mult(this.accel, 1/69550); // change to km

	// (G*(m1*m2/r^2))/m2
	
		var m1 = this.mass; var m2 = s1.mass;
		//m1 = m1*sunMass; m2 = m2*sunMass; // change to kg

		var r = mag(this.accel);

		this.accel = unit(this.accel);
		this.accel = mult(this.accel, (G*(m1*m2/(r*r)))/m2);
		
		this.vel = add(this.vel, this.accel);
		this.pos = add(this.pos, this.vel);
	}
}

render = function(){
	cwidth = canvas.width = window.innerWidth;
	cheight = canvas.height = window.innerHeight;
	gfx.font = "22px verdana";

	gfx.clearRect(0,0,cwidth,cheight);

	gfx.strokeStyle = gfx.fillStyle = 'white';
	gfx.beginPath();
	gfx.moveTo(s1.pos.x,s1.pos.y);
	gfx.lineTo(s2.pos.x,s2.pos.y);
	gfx.stroke();

	gfx.lineWidth = 3;
	gfx.beginPath();
	gfx.moveTo(cwidth/2, 10);
	gfx.lineTo(cwidth/2+solarRad, 10);
	gfx.stroke();
	gfx.lineWidth = 1;

	gfx.fillText(solarRad + " pixels = 1 Solar Radii = " + kmPerRad + " km", cwidth/2-100, 35);
	gfx.fillText("1 Sun Mass = " + sunMass + " kg", cwidth/2-100, 60);

	gfx.strokeStyle = gfx.fillStyle = 'yellow';
	var p = sub(s2.pos,s1.pos);
	var d = mag(p);
	p = unit(p);
	if(s1.mass < s2.mass){
		p = mult(p,d/2*(s1.mass/s2.mass));
	}else{
		p = mult(p,d/2*(s2.mass/s1.mass));
	}
	p = add(p,s1.pos);
	yellowPos = p;

	gfx.beginPath();
	//gfx.arc((s1.pos.x+s2.pos.x)/2,(s1.pos.y+s2.pos.y)/2,2,0,Math.PI*2);
	gfx.arc(p.x,p.y,2,0,Math.PI*2);
	gfx.fill(); gfx.stroke();

	gfx.strokeStyle = gfx.fillStyle = 'red';
	gfx.fillText('Star 1 vel: ' + s1.vel.x.toFixed(4) + ' , ' + s1.vel.y.toFixed(4), 20,250);
	gfx.fillText('Star 1 accel: ' + s1.accel.x.toFixed(4) + ' , ' + s1.accel.y.toFixed(4), 20,280);
	gfx.beginPath();
	gfx.arc(s1.pos.x,s1.pos.y,s1.mass*solarRad,0,Math.PI*2);
	gfx.fill(); gfx.stroke();

	gfx.strokeStyle = gfx.fillStyle = 'blue';
	gfx.fillText('Star 2 vel: ' + s2.vel.x.toFixed(4) + ' , ' + s2.vel.y.toFixed(4), 20,310);
	gfx.fillText('Star 2 accel: ' + s2.accel.x.toFixed(4) + ' , ' + s2.accel.y.toFixed(4), 20,340);
	gfx.beginPath();
	gfx.arc(s2.pos.x,s2.pos.y,s2.mass*solarRad,0,Math.PI*2);
	gfx.fill(); gfx.stroke();

	if(showVecs){
		gfx.lineWidth = 3;

		gfx.strokeStyle = gfx.fillStyle = 'red';
		gfx.save();
		gfx.translate(s1.pos.x, s1.pos.y); 
		
		gfx.beginPath(); gfx.moveTo(0,0);
		gfx.lineTo(s1.vel.x*200,s1.vel.y*200); gfx.stroke();

		gfx.beginPath(); gfx.moveTo(0,0);
		gfx.lineTo(s1.accel.x*50000,s1.accel.y*50000); gfx.stroke();

		gfx.restore();

		gfx.strokeStyle = gfx.fillStyle = 'blue';
		gfx.save();
		gfx.translate(s2.pos.x, s2.pos.y); 
		
		gfx.beginPath(); gfx.moveTo(0,0);
		gfx.lineTo(s2.vel.x*200,s2.vel.y*200); gfx.stroke();

		gfx.beginPath(); gfx.moveTo(0,0);
		gfx.lineTo(s2.accel.x*50000,s2.accel.y*50000); gfx.stroke();

		gfx.restore();

		gfx.lineWidth = 3;
	}

	if(trace){
		for(var i in redTrace){
			gfx.strokeStyle = gfx.fillStyle = 'red';
			gfx.beginPath();
			gfx.arc(redTrace[i].x,redTrace[i].y,2,0,Math.PI*2);
			gfx.fill(); gfx.stroke();

			gfx.strokeStyle = gfx.fillStyle = 'blue';
			gfx.beginPath();
			gfx.arc(blueTrace[i].x,blueTrace[i].y,2,0,Math.PI*2);
			gfx.fill(); gfx.stroke();

			gfx.strokeStyle = gfx.fillStyle = 'yellow';
			gfx.beginPath();
			gfx.arc(yellowTrace[i].x,yellowTrace[i].y,2,0,Math.PI*2);
			gfx.fill(); gfx.stroke();
		}

		if(tick === 0 && play){
			redTrace.push(s1.pos);
			blueTrace.push(s2.pos);
			yellowTrace.push(yellowPos);
		}
	}

	if(play){
		s1.update(); s2.update();
		gBox.value = G; m1Box.value = s1.mass; m2Box.value = s2.mass;
		v1Box.value = initV1; v2Box.value = initV2;
		tick++;
		if(tick == 25){ tick = 0; }
	}
}

lerp = function(oldMin,oldMax,oldVal,newMin,newMax){
	return (oldVal-oldMin)/(oldMax-oldMin)*(newMax-newMin)+newMin;
}

dist = function(v1,v2){ return mag(add(v1,neg(v2))); }

vec2 = function(x,y){ this.x = x; this.y = y; }
add = function(v1, v2){ return new vec2(v1.x+v2.x, v1.y+v2.y); }
sub = function(v1, v2){ return new vec2(v1.x-v2.x, v1.y-v2.y); }
neg = function(v){ return new vec2(-v.x, -v.y); }
mag = function(v){ return Math.sqrt(Math.pow(v.x,2) + Math.pow(v.y,2)); }
dot = function(v1,v2){ return v1.x*v2.x + v1.y*v2.y; }
unit = function(v){ return new vec2(v.x/mag(v), v.y/mag(v)); }
mult = function(v,s){ return new vec2(v.x*s, v.y*s); }

	</script>
</head>
<body bgcolor="black">
	<form>
		<input type="button" value="start" id="playButton">&nbsp;&nbsp;&nbsp;
		<input type="button" value="reset" id="resetButton">&nbsp;&nbsp;&nbsp;
		<input type="button" value="hide trace" id="traceButton">&nbsp;&nbsp;&nbsp;
		<input type="button" value="hide vectors" id="vecButton">
		<br><br>
		<b1>G: </b1><input type="text" size="7" id="gBox">&nbsp;&nbsp;&nbsp;
		<b1>ecc: </b1><input type="text" size="2" id="eccBox">&nbsp;&nbsp;&nbsp;
		<b1>period: </b1><input type="text" size="15" id="pBox"><br><br>
		<b1>initV 1: </b1><input type="text" size="6" id="v1Box">&nbsp;&nbsp;&nbsp;
		<b1>initV 2: </b1><input type="text" size="6" id="v2Box"><br><br>
		<b1>Mass 1 (Sun Mass): </b1><input type="text" size="2" id="m1Box">&nbsp;&nbsp;&nbsp;
		<b1>Mass 2 (Sun Mass): </b1><input type="text" size="2" id="m2Box"><br><br>
		<b1>Separation (Solar Radii): </b1><input type="text" size="2" id="sepBox">
	</form>
</body>